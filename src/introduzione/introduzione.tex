\newcommand{\percc}[1]{$#1$\%}

\chapter{Introduzione}

%Verrà indicato l'obbiettivo: 
%Sviluppare un sistema di classificazione software basato sulle sequenze di chiamate api attraverso
%tecniche di machine learning.

%Verrà esplicitato il mio contributo: indicare la raccolta dei vari dataset, standardizzazione di essi per fornire un input comune
%all'applicativo python per la classificazione delle sequenze di chiamate api progettato in OOP\@

Con l'avvento dell'era digitale, sempre più attività e servizi sono migrati verso il mondo online: \
dall' e-commerce alla pubblica amministrazione, fino ai servizi finanziari e sanitari.\
In italia, secondo i dati ISTAT,l'\percc{86,2} delle famiglie italiane dispone \
di un accesso ad internet a testimonianza di un uso sempre più popolare\cite{istat.internet-usage}.

Tuttavia, l'aumento della connettività comporta inevitabilmente anche una maggiore esposizione alle minacce \
informatiche. Nel 2024, l'Italia ha registrato il \percc{10} degli attacchi informatici\
globali; secondo il rapporto Clusit, circa un terzo di tali attacchi è stato veicolato tramite\
l'utilizzo di malware\cite{clusit.italy-malware}.

Per malware si intende un istanza di un programma il cui intento sia malevole \
come carpire informazioni personali e/o arrecare danni ai dispositivi\cite{idika2007survey}.

Per poter identificare i malware esistono due tipi di analisi: statica e dinamica.
L'analisi statica prevede l'analisi del codice binario, analizzando ogni ramo di esecuzione possibile alla ricerca\
di codice malevolo.\
L'analisi dinamica invece prevede l'esecuzione del programma cercando di identificare un insieme di comportamenti\
noti tra i malware\cite{doi:10.1155/2015/659101}.\

Per comportamenti intendiamo l'insieme (ordinato) delle chiamate Api al Kernel per permettere l'esecuzione dell'applicativo.\
Un singolo \myquote{comportamento} è effettivamente la singola chiamata Api prendendo il nome di \myquote{Api Call}; mentre la lista (ordinata)\
prende il nome \myquote{API call sequence}\cite{6680850}.

L'obbiettivo di questo caso di studio è di poter classificare un programma in base ai suoi comportamenti.\
Per raggiungere tale scopo sono stati raccolti diversi dataset di sequenza di chiamate api sul sistema operativo Windows ed è stato\
progettato e idealizzato un applicativo python (seguendo il paradigma \textit{OOP}) che attraverso \
algoritmi di machine-learning riesca a classificare un programma in base alla sua sequenza di chiamate api.

\section{Formato Windows PE malware}

Per poter eseguire un programma in \texttt{Microsoft Windows}, la logica applicativa deve essere interpretabile dal sistema operativo.\
Il formato che mette a disposizione il sistema operativo \texttt{Microsoft Windows} è \texttt{PE} (Portable Executable), denominato cosi poiche\
si riferisce che il formato non è specifico dell'architettura\cite{Microsoft-PE}.

Un file in formato \textbf{PE} ha nel seguente ordine le seguenti intestazioni:

\begin{itemize}
      \item \textbf{Stub MS-DOS}: area iniziale del file PE, compatibile con il sottosistema \texttt{MS-DOS}.
            In assenza di istruzioni specifiche da parte dello sviluppatore, contiene un programma di default che
            visualizza il messaggio: \myquote{Impossibile eseguire questo programma in modalità DOS}.
      \item \textbf{Firma PE}: campo che identifica il file come appartenente al formato \textbf{Portable Executable (PE)}
            e ne consente il corretto riconoscimento da parte del loader di Windows.
      \item \textbf{Intestazione COFF}: fornisce informazioni fondamentali sul file, come il tipo di macchina su cui è
            destinato a essere eseguito, il numero di sezioni e la data di compilazione.

      \item \textbf{Intestazione facoltativa (solo immagine)}: sezione che specifica le informazioni necessarie al
            caricamento ed esecuzione del programma. È composta da tre sottosezioni principali:
            \begin{itemize}
                  \item \textbf{Campi standard intestazione facoltativi }: includono l'indirizzo di entry point del programma, la dimensione del codice
                        e dei dati, e altri parametri di base.

                  \item \textbf{Campi specifici dell'intestazione facoltativa di Windows}: contengono informazioni più dettagliate, come la versione
                        minima del sistema operativo richiesto, le dimensioni massime di heap e stack, e i valori di allineamento.

                  \item \textbf{Directory dati intestazione facoltative}: riferimenti alle tabelle e alla loro dimensione delle risorse esterne come le \textbf{ddl}.
            \end{itemize}
\end{itemize}

Una \textbf{DDL} è una libreria che contiene codice e dati utilizzabili da più di un programma contemporaneamente.\
Ogni programma può utilizzare le \texttt{DDL} del sistema operativo windows per ottenere memoria, accesso a risorse,\
far apparire elementi a schermo ed accedere alla rete\cite{Microsoft-DLL}.

I malware utilizzano queste librerie per poter eseguire comportamenti malevoli.

\section{Categorie Malware}

La definizione di \textit{malware} è generica e include tutte le tipologie di software malevolo; per agevolare le attività di rilevamento e classificazione,\
è utile suddividerli in categorie più specifiche sulla base delle loro finalità e modalità di azione.

Nel contesto di questo lavoro di tesi, sono state individuate e considerate le seguenti specializzazioni di software:

\begin{itemize}
      \item \textbf{Unknown}: applicazioni per le quali non è stato possibile determinate con certezza se sono benevoli o meno.
      \item \textbf{Goodware}: software legittimo, privo di finalità malevoli.
      \item \textbf{Malware}: denominazione generica per software malevolo, utilizzata nei casi in cui non sia possibile definire una categoria più specifica
      \item \textbf{Backdoor}: programma che crea un accesso nascosto al sistema compromesso, permettendo all'attaccante di controllarlo da remoto\cite{Kaspersky-malware_backdoor}.
      \item \textbf{Trojan}: software che si maschera da applicazione legittima ma che, una volta eseguito, consente operazioni malevole come la modifica\
            o la cancellazione dei dati\cite{Cisco-Malware_Taxonomy}.
      \item \textbf{Virus}: programma in grado di infettare altri file e diffondersi all'interno di un sistema, con lo scopo di danneggiare il corretto funzionamento dell'host\cite{Cisco-Malware_Taxonomy}.
      \item \textbf{Worm}:  simili ai virus, ma in grado di diffondersi autonomamente attraverso la rete, senza richiedere l'intervento dell'utente\cite{Cisco-Malware_Taxonomy}.
      \item \textbf{Dropper}: componente malevolo progettato per scaricare o installare altri malware sul sistema target\cite{Kaspersky-malware_dropper}.
      \item \textbf{Spyware}: software che raccoglie informazioni sensibili dall'utente o dal sistema infetto e le trasmette a un'entità esterna\cite{Cisco-Malware_Taxonomy}.
      \item \textbf{Adware}: programma che raccoglie informazioni sulle abitudini dell'utente al fine di proporre pubblicità mirata; in alcuni casi può deviare la navigazione verso siti malevoli\cite{Cisco-Malware_Taxonomy}.
      \item \textbf{Packed}: malware compresso (almeno una volta) tramite tecniche di \textit{packing} per eludere i controlli degli antivirus\cite{Kaspersky-malware_MultiPacked}.
\end{itemize}

\section{Chiamata Api Windows}

%Dettagliare una chiamata api di windows.

Le chiamate API (Application Programming Interface) di sistema consentono agli sviluppatori di accedere alle risorse della macchina necessarie per l'esecuzione di un applicativo.\
Attraverso tali interfacce è possibile interagire con componenti fondamentali come la rete, la memoria, i dispositivi di input/output e l'interfaccia grafica.\
Le API risultano fortemente dipendenti dal sistema operativo su cui vengono eseguite.


In ambiente Windows, le API garantiscono che un'applicazione possa funzionare correttamente su diverse versioni del sistema operativo, sfruttando al tempo stesso le specifiche funzionalità\
introdotte nelle specifiche versioni\cite{Microsoft-api}.\
Le API di Windows coprono un ampio spettro di funzionalità, tra cui: interfaccia utente e shell, gestione dell'input e della messaggistica, accesso ai dati e archiviazione,
diagnostica, grafica e multimedialità, dispositivi, servizi di sistema, sicurezza e identità, installazione e manutenzione di applicazioni, amministrazione e gestione del sistema, rete e connettività Internet.

Un esempio applicativo è costituito dal malware di tipo \textbf{Spyware}, che può invocare ripetutamente la funzione \texttt{GetKeyboardState}\cite{Microsoft-GetKeyboardState}\
per recuperare lo stato degli ultimi 256 tasti premuti dall'utente, potenzialmente contenenti credenziali sensibili.

Nella documentazione ufficiale, i requisiti della funzione sono riassunti in Tabella \ref{tab:GetKeyboardState-Requisiti}.

\begin{table}[ht]
      \centering
      \caption{Requisiti}
      \label{tab:GetKeyboardState-Requisiti}
      \begin{tabular}{ll}
            \toprule
            \textbf{Voce}               & \textbf{Valore}                                                              \\
            \midrule
            Client minimo supportato    & Windows 2000 Professional (solo app desktop)                                 \\
            Server minimo supportato    & Windows 2000 Server (solo app desktop)                                       \\
            Piattaforma di destinazione & Windows                                                                      \\
            Intestazione                & \texttt{winuser.h} (include \texttt{Windows.h})                              \\
            Libreria                    & \texttt{User32.lib}                                                          \\
            DLL                         & \texttt{User32.dll}                                                          \\
            Set di API                  & \texttt{ext-ms-win-ntuser-rawinput-l1-1-0} (Windows 10, versione 10.0.14393) \\
            \bottomrule
      \end{tabular}
\end{table}

Come si nota, alla voce \textbf{DLL} è indicata la libreria \texttt{User32.dll}.\
Questa verrà referenziata nella sezione \textit{Directory dati dell’intestazione facoltativa} dell’eseguibile corrispondente, permettendo al sistema operativo di risolvere la chiamata\
in fase di esecuzione.

Nel contesto di questo lavoro di tesi, non ci interessa la singola chiamata API in sé, quanto piuttosto il modo in cui tali chiamate si organizzano in sequenze,
le quali costituiscono la base per la classificazione del comportamento software.

\section{Contributi}

%Descrivere l'organizzazione della tesi in capitoli e riassumere il contenuto di ogni capitolo.